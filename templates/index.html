<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>QRFile Share – by zerquix</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <h1>📤 QRFile Share</h1>
    <p>Kirim file lokal antar perangkat via QR Code. Tanpa cloud, tanpa login.</p>

    <form id="uploadForm">
      <input type="file" name="file" required>
      <button type="submit">Unggah & Generate QR</button>
    </form>

    <div id="loading" class="hidden">⏳ Uploading...</div>

    <div id="result" class="hidden">
      <h2>✅ QR Code Siap</h2>
      <img id="qrImage" src="" alt="QR Code">
      <p><a id="downloadLink" href="#" download>📥 Klik di sini jika QR tidak bisa</a></p>
    </div>

    <footer>
      <p>© 2025 <a href="https://github.com/zerquix/qrfile-share" target="_blank">zerquix</a></p>
    </footer>
  </div>

  <script>
    const form = document.getElementById('uploadForm');
    const loading = document.getElementById('loading');
    const result = document.getElementById('result');
    const qrImage = document.getElementById('qrImage');
    const downloadLink = document.getElementById('downloadLink');

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const fileInput = form.querySelector('input[type="file"]');
      if (!fileInput.files.length) return;

      loading.classList.remove('hidden');
      result.classList.add('hidden');

      const formData = new FormData();
      formData.append('file', fileInput.files[0]);

      fetch('/upload', {
        method: 'POST',
        body: formData
      })
      .then(res => res.json())
      .then(data => {
        qrImage.src = data.qr_url + '?v=' + new Date().getTime(); // prevent cache
        downloadLink.href = data.download_url;
        result.classList.remove('hidden');
      })
      .catch(err => {
        alert("Upload gagal: " + err);
      })
      .finally(() => {
        loading.classList.add('hidden');
        form.reset();
      });
    });
  </script>
</body>
</html>
